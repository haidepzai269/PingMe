<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trò chuyện</title>
  <link rel="stylesheet" href="chat.css" />
  <link rel="stylesheet" href="chat-group.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
  
  <div class="chat-container">
    <!-- Sidebar -->
    <!-- Sidebar -->
    <aside class="sidebar">
      <button class="nav-btn" onclick="location.href='home.html'">
        <i class="fas fa-house"></i>
      </button>
      <button id="nav-comments" class="nav-btn">
        <i class="fas fa-comments"></i>
      </button>
      

  <!-- Avatar ở góc dưới -->
  <div id="sidebar-avatar" class="sidebar-avatar">
    <img src="default-avatar.png" alt="Avatar" id="sidebar-avatar-img">
  </div>
    </aside>

    <!-- Popup logout -->
    <div id="logout-popup" class="popup">
  <div class="popup-content">
    <span class="popup-close" onclick="document.getElementById('logout-popup').classList.remove('show')">&times;</span>
    <img class="popup-avatar" src="default-avatar.png" alt="avatar" id="logout-popup-img">
    <h2 class="popup-username" id="logout-popup-username">...</h2>
    <button id="logout-btn" class="popup-message-btn">Đăng xuất</button>
  </div>
    </div>


    <!-- Danh sách trò chuyện -->
    <section class="chat-list">
      <div id="chat-title" class="chat-title"></div>
      <div id="pingme-username" class="pingme-username">PingMe - ...</div>
      <input type="text" id="search-input" placeholder="Tìm kiếm..." />
      <h3 style="display:flex; align-items:center; justify-content:space-between;">
        <span>Gợi ý trò chuyện</span>
        <button id="create-group-btn" class="create-group-icon" title="Tạo nhóm">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" 
               stroke="gray" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        </button>
      </h3>
      
      <ul id="user-suggestions"></ul>
      <h3>Danh sách nhóm</h3>
      <ul id="group-list"></ul>
    </section>

    <!-- Khung chat -->
    <main class="chat-main">
      <div id="chat-header" class="chat-header">
        <span class="back-btn"><i class="fa fa-arrow-left"></i></span>
      </div>
      <div id="chat-messages" class="messages">
        <div class="skeleton-message"></div>
        <div class="skeleton-message mine"></div>
        <div class="skeleton-message"></div>
      </div>
      <div id="scrollToBottomBtn" class="scroll-to-bottom">
        <i class="fa-solid fa-angles-down"></i>
      </div>
      <div id="typing-indicator" class="typing-indicator"></div>
        <div id="reply-preview">
  <span id="reply-preview-text"></span>
  <button id="cancel-reply" style="
    position:absolute; right:5px; top:2px; border:none; background:none; cursor:pointer;
  "><i class="fa fa-times"></i></button>
        </div>

      <div class="chat-input">
        <!-- Nút upload và input file ẩn -->
        <button id="emoji-btn" title="Chọn emoji">
          <i class="fa-solid fa-face-smile"></i>
        </button>
        <button id="uploadBtn">
          <i class="fa-solid fa-camera"></i>
        </button>
        <input type="file" id="fileInput" accept="image/*,video/*" style="display: none" />
      
        <!-- Ô nhập tin nhắn và nút gửi -->
        <input type="text" id="message-input" placeholder="Nhập tin nhắn..." />
        <button id="send-btn" title="Gửi">
          <i class="fa-solid fa-location-arrow"></i>
        </button>
      </div>      
    </main>
  </div>
  <!-- Popup emoji picker -->
  <div id="emoji-picker" class="emoji-picker"></div>
  <!-- Modal xem ảnh toàn màn hình -->
  <div id="imageModal" class="image-modal">
    <span id="closeModal">&times;</span>
    <img id="modalImage" src="" alt="Xem ảnh">
  </div>

  <div id="chat-notification-container"></div>
   <!-- Popup tạo nhóm -->
   <div id="create-group-popup" style="
display:none;
position:fixed;
top:50%;
left:50%;
transform:translate(-50%, -50%);
background:#fff;
padding:20px;
border-radius:8px;
box-shadow:0 2px 10px rgba(0,0,0,0.3);
z-index:1000;
width:300px;
max-height:80vh;
overflow-y:auto;
">
<h3>Tạo nhóm mới</h3>
<input type="text" id="group-name" placeholder="Nhập tên nhóm" style="width:100%;margin-bottom:10px;padding:6px;" />
<div id="friend-list-for-group" style="margin-bottom:10px;"></div>
<div style="text-align:right;">
  <button id="cancel-create-group">Hủy</button>
  <button id="confirm-create-group">Tạo nhóm</button>
</div>
   </div>

   <!-- Overlay tối -->
   <div id="popup-overlay" style="
display:none;
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.5);
z-index:999;
   "></div>
  <!-- Popup xác nhận -->
  <div id="confirm-leave-popup" style="
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  background:#fff;
  padding:20px;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,0.3);
  z-index:1001;
  width:300px;
  text-align:center;
">
  <p id="confirm-leave-text">Bạn có chắc muốn thoát nhóm này?</p>
  <div style="margin-top:15px;">
    <button id="cancel-leave-btn" style="margin-right:10px;">Hủy</button>
    <button id="confirm-leave-btn" style="background:red;color:white;">Thoát</button>
  </div>
  </div>
  <div id="group-members-popup" >
  <h3>Thành viên nhóm</h3>
  <ul id="group-members-list"></ul>
  <button id="close-members-popup" style="margin-top:10px;">Đóng</button>
</div>
<div id="members-overlay"></div>
<!-- Popup profile -->
<div id="profile-popup" style="
  display:none;
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%, -50%);
  background:#fff;
  padding:20px;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,0.3);
  z-index:1100;
  width:300px;
  text-align:center;
">
  <img id="profile-avatar" src="" alt="Avatar" style="width:80px;height:80px;border-radius:50%;margin-bottom:10px;">
  <h3 id="profile-username"></h3>
  <p id="profile-bio" style="color:gray;"></p>
  <p id="profile-friends-count" style="color:#41e2d4; margin-top: 10px;"></p>
  <div style="margin-top:15px;">
    <button id="profile-action-btn"></button>
  </div>
  <button id="close-profile-popup" style="margin-top:15px;">Đóng</button>
</div>
<div id="profile-overlay" style="
  display:none;
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,0.5);
  z-index:1099;
"></div>
<!-- Voice Call Modal -->
<div id="call-modal">
  <div class="call-box">
    <!-- Thông tin người gọi/người nhận -->
    <div class="call-user">
      <img id="call-avatar" src="default-avatar.png" alt="avatar">
      <h3 id="call-username">Tên người dùng</h3>
    </div>

    <!-- Trạng thái -->
    <h2 id="call-status">Đang gọi...</h2>

    <!-- Thanh đo mic/remote -->
    <div id="meters" class="call-meters">
      <div>
        <div style="color:#0f0;">
          <i class="fa-solid fa-microphone"></i> Mic
        </div>
        <canvas id="local-meter" width="150" height="30"></canvas>
      </div>
      <div>
        <div style="color:#0ff;">
          <i class="fa-solid fa-volume-high"></i> Remote
        </div>
        <canvas id="remote-meter" width="150" height="30"></canvas>
      </div>
    </div>
    <div class="video-container">
      <video id="local-video" autoplay muted playsinline style="display:none;"></video>
      <video id="remote-video" autoplay playsinline style="display:none;"></video>
    </div>
    <audio id="remote-audio" autoplay playsinline></audio>

    <!-- Nút điều khiển -->
    <div class="call-actions">
      <button id="accept-call-btn"><i class="fa-solid fa-phone"></i></button>
      <button id="reject-call-btn"><i class="fa-solid fa-phone-slash"></i></button>
      <button id="end-call-btn"><i class="fa-solid fa-circle-xmark"></i></button>
      <button id="toggle-mic-btn"><i class="fa-solid fa-microphone"></i></button>
      <button id="toggle-speaker-btn"><i class="fa-solid fa-volume-high"></i></button>
    </div>
  </div>
</div>

<div id="toast-container"></div>



  <script type="module" src="chat-group.js"></script>
  <script type="module"  src="chat.js"></script>

</body>
</html>
